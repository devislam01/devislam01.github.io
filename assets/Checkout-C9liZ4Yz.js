import{n as T,p as F,e as B,f as p,h as A,r as m,c as R,o as g,a as l,w as o,b as t,F as M,j as E,i as b,t as y,l as d,k,q as C}from"./index-Bt2_kKyI.js";import{u as W}from"./orderStore-SbmYHD-b.js";const G={style:{display:"flex","align-items":"center",gap:"10px"}},H=["src"],J={style:{color:"#0f5841","font-size":"1.2rem"}},K={style:{color:"#0f5841","font-size":"1.2rem","text-align":"right"}},X={style:{display:"flex","align-items":"center",gap:"10px"}},Y={style:{color:"#0f5841","font-size":"1.2rem"}},Z={style:{color:"#0f5841","font-size":"1.2rem","text-align":"right"}},ee={style:{display:"flex","justify-content":"space-between",width:"100%","font-weight":"500","text-align":"left"}},te={style:{color:"#0f5841","font-size":"1.2rem"}},oe={style:{display:"flex","justify-content":"space-between",width:"100%","font-weight":"500","text-align":"left","margin-top":"10px"}},le={style:{color:"#0f5841","font-size":"1.2rem"}},ie={style:{"justify-self":"left"}},ne={style:{"justify-self":"left"}},re={style:{width:"100%","text-align":"left","font-weight":"700","margin-top":"10px","margin-bottom":"10px"}},se={key:0},ae={style:{"margin-bottom":"20px","text-align":"left"}},de=["src"],ue={style:{width:"100%",display:"flex","justify-content":"flex-end",gap:"8px"}},ge={__name:"Checkout",setup(pe){const _=W(),c=T(),z=F(),U=B(),u=p(0),S=p("self-pickup"),v=p("1"),x=p(!1),h=p(!1),D=p([]),P=p(0),I=p([]),s=p({orderID:"",receiptList:[{paymentID:null,receipt:[]}]}),j=async a=>{const e=await _.getOrderSummaries(a);D.value=e.shoppingCartObjs,P.value=e.total},Q=a=>a.productPrice*a.quantity,q=async()=>{var r;I.value=D.value.map(i=>({ProductID:i.productID,Qty:i.quantity,UnitPrice:i.productPrice}));const a={orderSummaries:I.value,ShippingWay:"Self-Pickup/Meet-Up",PaymentMethod:v.value},e=await _.checkout(a);e.code===200&&(s.value.orderID=((r=e.data.proceedToPayments[0])==null?void 0:r.orderID)||"",s.value.receiptList=e.data.proceedToPayments.map(i=>({paymentID:i.paymentID,qrCodeUrl:i.qrCode,productName:i.productName,price:i.price,receipt:[]})),v.value==1?x.value=!0:v.value==2&&(h.value=!0))},L=async a=>{const e=new FormData;e.append("OrderID",s.value.orderID);for(const[r,i]of s.value.receiptList.entries()){if(a===2){if(!i.receipt||i.receipt.length===0){U.info("Please upload your receipts");return}e.append(`ReceiptList[${r}].Receipt`,i.receipt[0].raw)}e.append(`ReceiptList[${r}].PaymentID`,i.paymentID)}try{(await _.confirmOrder(e)).code===200&&await z.push("/")}catch(r){console.error(r)}};return A(async()=>{const a=z.currentRoute.value.query;await j(a)}),(a,e)=>{const r=m("el-row"),i=m("el-col"),w=m("el-radio"),O=m("el-radio-group"),f=m("el-button"),V=m("el-dialog"),N=m("el-upload");return g(),R(M,null,[l(r,null,{default:o(()=>e[10]||(e[10]=[t("div",{style:{float:"left","font-weight":"bold",color:"#0f5841","font-size":"1.8rem",width:"100%","text-align":"left","margin-left":"50px","margin-bottom":"20px"}}," Order Summary ",-1)])),_:1}),l(r,{style:{"justify-content":"center"}},{default:o(()=>[l(i,{span:23,style:{padding:"20px 30px 30px 30px","border-style":"solid","border-color":"#0f5841","border-width":"2px","border-radius":"15px"}},{default:o(()=>[l(r,{gutter:20,style:{"border-bottom":"2px solid #0f5841","padding-bottom":"10px"}},{default:o(()=>[l(i,{span:9},{default:o(()=>e[11]||(e[11]=[t("div",{style:{color:"#0f5841","font-size":"1.2rem","text-align":"left","font-weight":"500"}}," Product Ordered ",-1)])),_:1}),l(i,{span:5},{default:o(()=>e[12]||(e[12]=[t("div",{style:{color:"#0f5841","font-size":"1.2rem","text-align":"right","font-weight":"500"}}," Unit Price ",-1)])),_:1}),l(i,{span:5},{default:o(()=>e[13]||(e[13]=[t("div",{style:{color:"#0f5841","font-size":"1.2rem","text-align":"right","font-weight":"500"}}," Quantity ",-1)])),_:1}),l(i,{span:5},{default:o(()=>e[14]||(e[14]=[t("div",{style:{color:"#0f5841","font-size":"1.2rem","text-align":"right","font-weight":"500"}}," Subtotal ",-1)])),_:1})]),_:1}),(g(!0),R(M,null,E(D.value,(n,$)=>(g(),b(r,{gutter:20,style:{"padding-bottom":"10px","margin-top":"10px","margin-bottom":"10px"},key:$},{default:o(()=>[l(i,{span:9},{default:o(()=>[t("div",G,[t("img",{style:{width:"150px"},src:n.productImage,alt:""},null,8,H),t("div",J,y(n.productName),1)])]),_:2},1024),l(i,{span:5,style:{"align-content":"space-evenly"}},{default:o(()=>[t("div",K," RM "+y(n.productPrice),1)]),_:2},1024),l(i,{span:5,style:{"align-content":"space-evenly","justify-items":"right"}},{default:o(()=>[t("div",X,[t("div",Y,y(n.quantity),1)])]),_:2},1024),l(i,{span:5,style:{"align-content":"space-evenly"}},{default:o(()=>[t("div",Z," RM "+y(Q(n)),1)]),_:2},1024)]),_:2},1024))),128)),e[30]||(e[30]=t("hr",{style:{border:"0",height:"1px","background-color":"#0f5841",width:"100%"}},null,-1)),t("div",ee,[e[15]||(e[15]=t("div",{style:{color:"#0f5841","font-size":"1.2rem"}},"Subtotal:",-1)),t("div",te,"RM "+y(P.value),1)]),e[31]||(e[31]=t("hr",{style:{border:"0",height:"1px","background-color":"#0f5841",margin:"10px 0",width:"100%"}},null,-1)),e[32]||(e[32]=t("div",{style:{display:"flex","justify-content":"space-between",width:"100%","font-weight":"500","text-align":"left","margin-top":"10px"}},[t("div",{style:{color:"#0f5841","font-size":"1.2rem"}},"Shipping:"),t("div",{style:{color:"#0f5841","font-size":"1.2rem"}},"Free")],-1)),e[33]||(e[33]=t("hr",{style:{border:"0",height:"1px","background-color":"#0f5841",margin:"10px 0",width:"100%"}},null,-1)),t("div",oe,[e[16]||(e[16]=t("div",{style:{color:"#0f5841","font-size":"1.2rem"}},"Total:",-1)),t("div",le,"RM "+y(P.value),1)]),e[34]||(e[34]=t("div",{style:{float:"left","font-weight":"700",color:"#0f5841","font-size":"1.3rem",width:"100%","text-align":"left","margin-top":"20px","margin-bottom":"20px"}}," Shipping Option ",-1)),t("div",ie,[l(O,{modelValue:S.value,"onUpdate:modelValue":e[0]||(e[0]=n=>S.value=n)},{default:o(()=>[l(w,{value:"self-pickup"},{default:o(()=>e[17]||(e[17]=[d("Self-Pickup / Meet-Up")])),_:1})]),_:1},8,["modelValue"])]),e[35]||(e[35]=t("div",{style:{float:"left","font-weight":"700",color:"#0f5841","font-size":"1.3rem",width:"100%","text-align":"left","margin-top":"20px","margin-bottom":"20px"}}," Payment Method ",-1)),t("div",ne,[l(O,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n)},{default:o(()=>[l(w,{value:"1"},{default:o(()=>e[18]||(e[18]=[d("Cash on Delivery (COD)")])),_:1}),l(w,{value:"2"},{default:o(()=>e[19]||(e[19]=[d("QR Code")])),_:1})]),_:1},8,["modelValue"])]),l(f,{round:"",color:"#0F5841",onClick:q,style:{margin:"30px 0 0 0","background-image":"linear-gradient(to right, #0f5841, #87ab9f)",border:"none"},size:"large"},{default:o(()=>e[20]||(e[20]=[d("Place Order")])),_:1}),l(V,{modelValue:x.value,"onUpdate:modelValue":e[4]||(e[4]=n=>x.value=n),title:"Order Confirmation",width:"30%","align-center":""},{footer:o(()=>[l(f,{onClick:e[2]||(e[2]=n=>x.value=!1)},{default:o(()=>e[21]||(e[21]=[d("Close")])),_:1}),l(f,{type:"primary",loading:k(c).loading,disabled:k(c).loading,onClick:e[3]||(e[3]=n=>L(1))},{default:o(()=>e[22]||(e[22]=[d("Confirm")])),_:1},8,["loading","disabled"])]),default:o(()=>[e[23]||(e[23]=t("span",null,"Are you sure you want to place this order using Cash on Delivery(COD)?",-1))]),_:1},8,["modelValue"]),l(V,{modelValue:h.value,"onUpdate:modelValue":e[9]||(e[9]=n=>h.value=n),title:"QR Payment Confirmation",width:"22vw","align-center":""},{footer:o(()=>[t("div",ue,[u.value>0?(g(),b(f,{key:0,onClick:e[6]||(e[6]=n=>u.value--)},{default:o(()=>e[26]||(e[26]=[d(" Previous ")])),_:1})):C("",!0),u.value<s.value.receiptList.length-1?(g(),b(f,{key:1,onClick:e[7]||(e[7]=n=>u.value++)},{default:o(()=>e[27]||(e[27]=[d(" Next ")])),_:1})):C("",!0),u.value===s.value.receiptList.length-1?(g(),b(f,{key:2,type:"primary",loading:k(c).loading,disabled:k(c).loading,onClick:e[8]||(e[8]=n=>L(2))},{default:o(()=>e[28]||(e[28]=[d(" Confirm Order ")])),_:1},8,["loading","disabled"])):C("",!0)])]),default:o(()=>[e[29]||(e[29]=t("div",{style:{"text-align":"justify"}}," Please scan the QR code below and transfer the exact total amount of your order to complete the payment. After the transfer, kindly upload a screenshot of the payment receipt as proof. ",-1)),t("div",re," Price Need to Transfer: RM "+y(s.value.receiptList[u.value].price),1),s.value.receiptList.length>0?(g(),R("div",se,[t("div",ae,[t("img",{src:s.value.receiptList[u.value].qrCodeUrl,alt:"QR Code",style:{width:"100%"}},null,8,de),l(N,{"file-list":s.value.receiptList[u.value].receipt,"onUpdate:fileList":e[5]||(e[5]=n=>s.value.receiptList[u.value].receipt=n),class:"upload-demo",style:{width:"100%","margin-top":"10px"},action:"#",limit:1,"auto-upload":!1},{trigger:o(()=>[l(f,{type:"primary"},{default:o(()=>e[24]||(e[24]=[d("Upload Payment Receipt")])),_:1})]),tip:o(()=>e[25]||(e[25]=[t("div",{class:"el-upload__tip text-red"}," Limit 1 file, new file will replace the old one. ",-1)])),_:1},8,["file-list"])])])):C("",!0)]),_:1},8,["modelValue"])]),_:1})]),_:1})],64)}}};export{ge as default};
